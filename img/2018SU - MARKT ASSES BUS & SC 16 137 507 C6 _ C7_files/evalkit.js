function evalkit_modal_iframe(){var n=document.getElementById("ek-modal-iframe"),t=document.getElementById("ek-modal-iframe-loading");n.style.display="";t.style.display="none"}function evalkit_modal_iframe_resize(){var t=document.getElementById("ek-modal-iframe"),n;t!==null&&t.setAttribute("height",window.innerHeight-180);n=document.getElementById("ek-modal-iframe-loading");n!==null&&n.setAttribute("height",window.innerHeight-180)}function evalkit_createCookie(n,t){var i=new Date,r=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds());sessionStorage.setItem(n+"_E",r);sessionStorage.setItem(n,t)}function evalkit_readCookie(n){var i=sessionStorage.getItem(n+"_E");if(i==null)return sessionStorage.removeItem(n),null;var t=new Date,r=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),u=r-i;return u>18e5?(sessionStorage.removeItem(n+"_E"),sessionStorage.removeItem(n),null):sessionStorage.getItem(n)}var evalkit_loaded=0,evalkit_issafari=navigator.userAgent.indexOf("Safari")!==-1&&(navigator.userAgent.indexOf("Chrome")===-1||navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("OPR")>-1),EvaluationKIT={onLoad:function(){if(!(window.location.href.indexOf("sessionless_launch")>-1)&&($("#dashboard").length!==0||$(".context_external_tool_"+evalkit_setup.auth_external_tool_id).length!==0||this.getPageCourseId()!==0||document.location.href.indexOf("/profile")!==-1)&&(evalkit_loaded+=1,!(evalkit_loaded>3))){var n=this.getTokenCookie(),t=this.getVerifyCookie();if(n.length===0||t!==ENV.current_user_id)this.onLti();else this.onUser(n)}},onLti:function(){var n=this;n.startInit(function(){var n=EvaluationKIT||{};n.onAuth()})},startInit:function(n){var t=this,i=t.getInitCookie();if(i===null||i!==!1){if(i!==null&&i===!0){n();return}$.get("/api/v1/users/self/profile",function(i){if(i.login_id.length>0){var r=t.getPageCourseId();if(r>0)$.get("/api/v1/courses/"+r,function(r){if(r.id>0)t.onAuthInit(i.id,i.login_id,r.id,r.course_code,n);else t.setInitCookie(!1)});else t.onAuthInit(i.id,i.login_id,0,"",n)}else t.setInitCookie(!1)})}},onAuthInit:function(n,t,i,r,u){var f=this;$.get(evalkit_setup.account_url+"/Canvas/InitCheck?authId="+evalkit_setup.auth_external_tool_id+"&username="+encodeURIComponent(t)+"&userid="+n+"&coursecode="+encodeURIComponent(r)+"&courseid="+i+"&refer="+encodeURIComponent(window.location.pathname+window.location.search)+"&nocache="+(new Date).getTime(),function(n){(f.setInitCookie(n.result),n.result!==!1)&&u()})},onAuth:function(){var t=this,n=t.createCORSRequest("GET","/api/v1/accounts/"+evalkit_setup.account_id+"/external_tools/sessionless_launch?launch_type=user_navigation&url="+encodeURIComponent(evalkit_setup.service_url+"/canvas/authlti"));n&&(n.onload=function(){var t,i;n.status===200?(t=$.parseJSON(n.responseText.replace("while(1);","")),$("#evalkit-lti").length>0?$("#evalkit-lti").attr("src",t.url):$('<iframe src="'+t.url+'" id="evalkit-lti" style="display:none;"><\/iframe>').appendTo($("body"))):(i=EvaluationKIT||{},i.onLoad())},n.send())},onLtiResponse:function(n){var i,t,r;if(n.origin!==null&&(n.origin.toLowerCase().indexOf(evalkit_setup.service_url)!==-1||n.origin.toLowerCase().indexOf(evalkit_setup.account_url)!==-1)&&n.data!==null&&n.data.length!==undefined){if(i=EvaluationKIT||{},t=JSON.parse(n.data),t===null){console.log("DEBUG: onLtiResponse - jsondata error");return}switch(t.subject){case"evalkit.location":window.top.location.href=t.url;break;case"evalkit.ltiresponse":r=t.token;r.length===0&&(r="-1");i.setTokenCookie(r);i.setVerifyCookie(ENV.current_user_id);i.onLoad()}}},onUser:function(n){n!=="-1"&&this.startInit(function(){var u=EvaluationKIT||{},r=u.getPageCourseId(),t,f,i;if(document.getElementById("ek_css")===null&&(t=document.createElement("link"),t.setAttribute("id","ek_css"),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",evalkit_setup.account_url+"/scripts/canvas/style.min.css"),document.getElementsByTagName("head")[0].appendChild(t)),r===0)u.getUserSettings(n,r,"");else{if(f="/api/v1/courses/"+r,i=u.createCORSRequest("GET",f),!i)return;i.onload=function(){var t="",u,o,f;try{u=$.parseJSON(i.responseText);t=u.course_code}catch(e){o=EvaluationKIT||{};newobjerrnfo.onError(e)}f=EvaluationKIT||{};f.getUserSettings(n,r,t)};i.onerror=function(n){var t=EvaluationKIT||{};t.onError(n);t.onLoad()};i.send()}})},getUserSettings:function(n,t,i){var r=this.createCORSRequest("GET",evalkit_setup.service_url+"/canvas/usersettings?token="+encodeURIComponent(n)+"&userid="+ENV.current_user_id+(t>0?"&courseid="+t+"&coursecode="+encodeURIComponent(i)+"&courseTitle=":"")+"&refer="+encodeURIComponent(window.location.pathname+window.location.search)+"&nocache="+(new Date).getTime());r&&(r.onload=function(){var u,n,i,f;if(r.status===401)u=EvaluationKIT||{},u.onLti();else{try{n=$.parseJSON(r.responseText);i=EvaluationKIT||{};i.onPopup(n);i.onWidget(n);i.onLinks(n,t);$(document).on("click",".ek-sessionless",function(n){var i=$(this).attr("href"),r,t;(evalkit_issafari?i=$(this).data("safariurl"):n.preventDefault(),r=EvaluationKIT||{},t=r.createCORSRequest("GET",i),t)&&(t.onload=function(){var n,i,r;t.status===200?(n=$.parseJSON(t.responseText.replace("while(1);","")),typeof n.url!="undefined"&&n!==null&&n.url.length>0?ek_modal.open({iframelink:n.url,buttons:null,iframeheight:800,cssclass:"evalkit-modal-lg",showClose:!0,type:"notification"}):(i=EvaluationKIT||{},i.onLti())):(r=EvaluationKIT||{},r.onLti())},t.send())})}catch(e){f=EvaluationKIT||{};f.onError(e)}return}},r.onerror=function(n){var t=EvaluationKIT||{};if(navigator.appVersion.indexOf("MSIE 10")>-1||navigator.appVersion.indexOf("MSIE 9")>-1)t.onLti();else t.onError(n)},r.send())},onPopup:function(n){var r,t,i;n.popup.visible===!0&&(r=[],t=document.createElement("a"),t.innerHTML=n.popup.gotosurveytext,n.popup.gotosurveyurl.indexOf("sessionless_launch")>-1?(t.setAttribute("class","Button Button--primary ek-widget-btn-primary ek-sessionless"),evalkit_issafari?(t.setAttribute("href",evalkit_setup.account_url+"/MyEval/CookieSet.aspx"),t.setAttribute("data-safariurl",n.popup.gotosurveyurl),t.setAttribute("target","_blank")):t.setAttribute("href",n.popup.gotosurveyurl)):(evalkit_issafari&&(n.popup.gotosurveyurl=evalkit_setup.account_url+"/MyEval/SafariRedirect.aspx?ret="+encodeURIComponent(window.location.origin+n.popup.gotosurveyurl)),t.setAttribute("class","Button Button--primary ek-widget-btn-primary"),t.setAttribute("href",n.popup.gotosurveyurl)),r[0]=t,n.popup.remindlater&&(i=document.createElement("a"),i.innerHTML=n.popup.remindlatertext,i.setAttribute("href","#"),i.setAttribute("class","Button ek-widget-btn-default"),i.onclick=n.popup.incrementDefer===!0?function(t){t.preventDefault();ek_modal.close();var i=EvaluationKIT||{};$.get(evalkit_setup.service_url+"/canvas/Defer?token="+encodeURIComponent(i.getTokenCookie())+"&projectId="+n.popup.projectId+"&courseId="+n.popup.courseId+"&nocache="+(new Date).getTime())}:function(n){n.preventDefault();ek_modal.close()},r[1]=i),ek_modal.open({title:n.popup.header,body:n.popup.body,buttons:r,showClose:!1,type:n.popup.blockPage===!0?"blocker":"notification"}))},onWidget:function(n){$(".ek-widget").remove();$(n.widget).appendTo("#right-side");evalkit_issafari&&n.widget!=null&&$(".ek-widget a").each(function(){var n=$(this);n.hasClass("ek-sessionless")?(n.attr("data-safariurl",n.attr("href")),n.attr("href",evalkit_setup.account_url+"/MyEval/CookieSet.aspx"),n.attr("target","_blank")):n.attr("href",evalkit_setup.account_url+"/MyEval/SafariRedirect.aspx?ret="+encodeURIComponent(window.location.origin+$(this).attr("href")))})},onLinks:function(n,t){$("a.context_external_tool_"+evalkit_setup.auth_external_tool_id).remove();this.setLink(n.userlink,t);this.setLink(n.studentlink,t);this.setLink(n.instructorlink,t);this.setLink(n.talink,t);this.setLink(n.adminlink,t)},createCORSRequest:function(n,t){try{var i=new XMLHttpRequest;return"withCredentials"in i?i.open(n,t,!0):typeof XDomainRequest!="undefined"?(i=new XDomainRequest,i.open(n,t)):i=null,i}catch(r){this.onError(r)}},getPageCourseId:function(){return typeof $("body").attr("class")!="undefined"?$("body").attr("class").match(/\bcontext-course_(.[0-9]*)/)?parseInt($("body").attr("class").match(/\bcontext-course_(.[0-9]*)/)[1]):0:0},getPageUserId:function(){return $("body").attr("class").match(/\bcontext-user_(.[0-9]*)/)?$("body").attr("class").match(/\bcontext-user_(.[0-9]*)/)[1]:""},getTokenCookie:function(){return evalkit_readCookie("evalkit_token_"+evalkit_setup.auth_external_tool_id)||""},setTokenCookie:function(n){evalkit_createCookie("evalkit_token_"+evalkit_setup.auth_external_tool_id,n)},getVerifyCookie:function(){return evalkit_readCookie("evalkit_verify_"+evalkit_setup.auth_external_tool_id)||""},setVerifyCookie:function(n){evalkit_createCookie("evalkit_verify_"+evalkit_setup.auth_external_tool_id,n)},getInitCookie:function(){var n=evalkit_readCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id),i,u,r,t;if((n===null||n==="")&&(n=-1),n!==-1&&n!==ENV.current_user_id)return evalkit_createCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id,ENV.current_user_id),evalkit_createCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id,""),null;if(i=evalkit_readCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id),i===null||i==="")return null;if(u=this.getSection(),u===null)return!1;for(r=JSON.parse(i),t=0;t<r.length;t++)if(r[t].section==u)return r[t].val;return null},setInitCookie:function(n){var i=evalkit_readCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id),u,t,f,r;if((i===null||i==="")&&(i=""),u=this.getSection(),u!==null){for(t=i.length===0?[]:JSON.parse(i),f=!1,r=0;r<t.length;r++)t[r].section==u&&(f=!0,t[r].val=n);f===!1&&t.push({section:u,val:n});evalkit_createCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id,ENV.current_user_id);evalkit_createCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id,JSON.stringify(t))}},getSection:function(){var n=null,t;return $("#dashboard").length>0?n="dashboard":document.location.href.indexOf("/profile")>-1?n="profile":(t=this.getPageCourseId(),t>0&&(n=t)),n},setLink:function(n,t){if(n!==null&&n.exttoolid!==0){var i=$("a.context_external_tool_"+n.exttoolid);if(n.linktype!=2||this.getPageUserId().length!==0){if(n.linktype==2&&this.getPageUserId().length>0)if(n.visible)i.length===0?($("<li class='section evalkitlink'><a style='display:block !important;' class='evalkituser context_external_tool_"+n.exttoolid+"' href='/users/"+ENV.current_user_id+"/external_tools/"+n.exttoolid+"'>"+n.title+"<\/a><\/li>").appendTo("#section-tabs"),i=$("a.context_external_tool_"+n.exttoolid)):(n.title!==i.html()&&i.html(n.title),i.attr("style","display: block !important;")),i.parent().show();else{i.hasClass("evalkit-ltilink")||i.parent().hide();return}else if(t>0)if(n.visible)i.length===0?($("<li class='section evalkitlink'><a style='display:block !important;' class='evalkitcourse context_external_tool_"+n.exttoolid+"' href='/courses/"+t+"/external_tools/"+n.exttoolid+"'>"+n.title+"<\/a><\/li>").appendTo("#section-tabs"),i=$("a.context_external_tool_"+n.exttoolid)):(i.html(n.title),i.attr("style","display: block !important;")),i.parent().show();else{i.hasClass("evalkit-ltilink")||i.parent().hide();return}i.addClass("evalkit-ltilink");i.length>0&&(n.badge!==null&&$('<b class="nav-badge evalkit-badge">'+n.badge+"<\/b>").prependTo(i),evalkit_issafari&&i.attr("href",evalkit_setup.account_url+"/MyEval/SafariRedirect.aspx?ret="+encodeURIComponent(window.location.origin+i.attr("href"))))}}},onError:function(n){console.log("EvaluationKIT Canvas User Integration Error: "+n);console.log("EvaluationKIT Canvas User Integration Error Stack: "+n.stack)}},ek_modal;$(document).ready(function(){var n=EvaluationKIT||{};window.addEventListener?window.addEventListener("message",n.onLtiResponse,!1):window.attachEvent("onmessage",n.onLtiResponse);n.onLoad()});ek_modal=function(){var o={},t,n,u,i,r,e,f;return t,t=document.createElement("div"),t.id="ek-overlay",t.style.display="none",n=document.createElement("div"),n.id="ek-modal",n.style.display="none",n.setAttribute("role","dialog"),n.setAttribute("tabindex","-1"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-labelledby","ek-modal-header"),f=document.createElement("div"),f.setAttribute("class","ek-modal-content"),u=document.createElement("h2"),u.setAttribute("class","ek-modal-header"),u.id="ek-modal-header",e=document.createElement("a"),e.setAttribute("id","ek-modal-close"),i=document.createElement("div"),i.setAttribute("class","ek-modal-body"),i.setAttribute("id","ek-modal-body"),r=document.createElement("div"),r.setAttribute("class","ek-modal-footer"),f.appendChild(u),f.appendChild(e),f.appendChild(i),f.appendChild(r),n.appendChild(f),o.open=function(f){var s,o;if(f===null){console.log("ek_modalopen settings === null");return}if(typeof f.cssclass!="undefined"&&f.cssclass!==null&&n.setAttribute("class",f.cssclass),i.innerHTML="",typeof f.iframelink!="undefined"&&f.iframelink!==null&&f.iframelink.length>0?(i.innerHTML='<iframe id="ek-modal-iframe-loading"><\/iframe><iframe src='+f.iframelink+' id="ek-modal-iframe" style=\'display:none;\' onload="evalkit_modal_iframe();"><\/frame>',window.removeEventListener("resize",evalkit_modal_iframe_resize),window.addEventListener("resize",evalkit_modal_iframe_resize),evalkit_modal_iframe_resize(),document.getElementById("ek-modal-close").style.display="",document.getElementById("ek-modal-iframe-loading").contentWindow.document.write('<html><head><\/head><body style="text-align:center;"><img src="'+evalkit_setup.account_url+'/Media/Images/loadingd2l.gif" style="padding-top:10%;" /><\/body><\/html>')):i.innerHTML=f.body,typeof f.title!="undefined"&&f.title!==null?(u.innerHTML=f.title,u.style.display=""):u.style.display="none",t.setAttribute("class","ek-overlay-"+f.type),f.type=="blocker"?(s=window.getComputedStyle(document.getElementById("header"),null).getPropertyValue("background-color"),s.length===0&&(s="rgb(57, 75, 88)"),t.style.background=s):t.style.background="",n.setAttribute("oncontextmenu","return false"),t.setAttribute("oncontextmenu","return false"),t.style.display="",n.style.display="",n.setAttribute("data-type",f.type),window.scrollTo(0,0),$("body").addClass("ek-modal-open"),setTimeout(function(){$("body").removeClass("ek-modal-open")},2e3),typeof f.buttons!="undefined"&&f.buttons!==null&&f.buttons.length>0){for(r.innerHTML="",o=0;o<f.buttons.length;o++)o===0&&f.buttons[o].focus(),r.appendChild(f.buttons[o]);r.style.display=""}else r.innerHTML="",r.style.display="none";f.showClose!==!0&&(e.style.display="none");e.onclick=f.refreshOnClose===!0?function(){$(document).keypress(function(n){if(n.keyCode==27)return n.preventDefault(),!1});ek_modal.close();document.location.href=document.location.href}:function(){ek_modal.close()}},o.close=function(){$("body").removeClass("ek-modal-open");t.style.display="none";n.style.display="none";i.innerHTML=""},document.body.appendChild(t),document.body.appendChild(n),o}();